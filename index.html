<!doctype html>
<html>
  <head>
    <title>JS1k, 1k demo submission [ID]</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <script>
      var b = document.body;
      document.body.clientWidth; // fix bug in webkit: http://qfox.nl/weblog/218
    </script>
    <script>
// abbreviate canvas methods
// for($ in a)a[$[0]+($[6]||'')]=a[$]

// get random number from [0,max)
R = function(m) {return Math.floor(Math.random()*m)}
// MAX value
MAX = function(a,b) {return Math.max(a,b)}
// integer division
DIV = function(a,b) {return ~~(a/b)}

// is p (2-int array) on (x,y)
on = function(p,x,y){
  return p[0]==x&&p[1]==y?1:0
}
var BG='#111'
var FG='#fff'
var W=H=60,H=30   // width,height
var p=[15,15]     // player position
var N=M=[]        // map

onkeydown=function(e){
  e=e.keyCode
  e^37?e^39?0:p[0]++:p[0]--
  e^38?e^40?0:p[1]++:p[1]--

  if(e>=37&&e<=40)redraw()
}
redraw = function(){
  S='<pre>'
  for(i=0;i<H;i++) {
    for(j=0;j<W;j++) {
      S+=M[i][j]?'#':(p[1]==i&&p[0]==j)?'@':' '
    }
    S+='\n'
  }
  b.innerHTML=S
}
// regenerate the map
regen = function(){
  for(i=0;i<H;i++){M[i]=[];for(j=0;j<W;j++){M[i][j]=(R(100)<40)?1:0}}
  for(i=0;i<H;i++){M[i][0]=1;M[i][W-1]=1;} // fill borders
  for(i=0;i<W;i++){M[0][i]=1;M[H-1][i]=1;} // same

  for(r = 0; r < 7; r++){
    redraw()
    // alert('redraw')
    N=[]
    for(i=0;i<H;i++) {
      N[i]=[]
      for(j=0;j<W;j++) {
        s=0
        for(n=-1;n<2;n++)for(m=-1;m<2;m++){
          s += !M[i+n] ? 1 : (mn=M[i+n][j+m]) ? 1 : mn!=!1
        }
        N[i][j] = s > 5 || (r < 5 && !s)
      }
    }
    M=N
  }
}
regen()
redraw()
    </script>
  </body>
</html>